<div class="row row-cols-1 row-cols-md-2 justify-content-center" id="listaVeiculos">
    <script>
        $(document).ready(function () {
            let requestOptions = {
                method: 'GET',
                redirect: 'follow'
            };

            fetch("http://localhost:3000/veiculo", requestOptions)
                .then(response => response.json())
                .then(result => {
                    result.forEach((veiculo, index) => {
                        const descricaoLimitada = veiculo.descricao.length > 100
                            ? veiculo.descricao.substring(0, 100) + '...'
                            : veiculo.descricao;

                        const card = `
                            <div class="card m-3" style="max-width: 540px;">
                                <div class="row g-0">
                                    <div class="col-md-4">
                                        <img src="${veiculo.imagem[0]}" class="img-fluid rounded-start veiculo-imagem" alt="${veiculo.modelo}" data-index="${index}">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <h5 class="card-title">${veiculo.modelo} - ${veiculo.ano}</h5>
                                            <p class="card-text">${descricaoLimitada}</p>
                                            <p class="card-text"><strong>Preço:</strong> R$ ${veiculo.preco.toLocaleString()}</p>
                                            <p class="card-text"><small class="text-body-secondary">Avaliação: ${veiculo.avaliacao} estrelas</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        $('#listaVeiculos').append(card);
                    });

                    $('.veiculo-imagem').on('click', function () {
                        const index = $(this).data('index');
                        const veiculo = result[index];

                        const carrosselImagensDetalhes = $('#carrosselImagensDetalhes');
                        carrosselImagensDetalhes.empty();
                        veiculo.imagem.forEach((imagem, index) => {
                            const item = `
                                <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                    <img src="${imagem}" class="d-block w-100" alt="Imagem do veículo">
                                </div>
                            `;
                            carrosselImagensDetalhes.append(item);
                        });

                        $('#veiculoTitulo').text(`${veiculo.modelo} - ${veiculo.ano}`);
                        $('#veiculoDescricao').text(veiculo.descricao);
                        $('#veiculoPreco').text(`R$ ${veiculo.preco.toLocaleString()}`);
                        $('#veiculoAno').text(veiculo.ano);
                        $('#veiculoQuilometragem').text(`${veiculo.quilometragem} km`);
                        $('#veiculoCor').text(veiculo.cor);
                        $('#veiculoPotencia').text(`${veiculo.potencia} cv`);
                        $('#veiculoMotor').text(veiculo.motor);
                        $('#veiculoCambio').text(veiculo.cambio);
                        $('#veiculoDirecao').text(veiculo.direcao);
                        $('#veiculoTracao').text(veiculo.tracao);
                        $('#veiculoAvaliacao').text(veiculo.avaliacao);
                        $('#veiculoDisponivel').text(veiculo.disponivel ? 'Sim' : 'Não');
                        $('#veiculoDestaque').text(veiculo.destaque ? 'Sim' : 'Não');

                        fetch(`http://localhost:3000/categoria/${veiculo.categoriaId}`)
                            .then(response => response.json())
                            .then(categoria => {
                                $('#veiculoCategoria').text(categoria.nome);
                            })
                            .catch(error => console.error('Erro ao carregar categoria:', error));

                        fetch(`http://localhost:3000/montadora/${veiculo.montadoraId}`)
                            .then(response => response.json())
                            .then(montadora => {
                                $('#veiculoMontadora').text(montadora.nome);
                            })
                            .catch(error => console.error('Erro ao carregar montadora:', error));

                        $('#modalVeiculo').modal('show');
                    });
                })
                .catch(error => console.log('error', error));
        });
    </script>
</div>

<div class="modal fade" id="modalVeiculo" tabindex="-1" aria-labelledby="modalVeiculoLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalVeiculoLabel">Detalhes do Veículo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="carrosselVeiculoDetalhes" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner" id="carrosselImagensDetalhes">
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carrosselVeiculoDetalhes" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Anterior</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carrosselVeiculoDetalhes" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Próximo</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3 id="veiculoTitulo"></h3>
                            <p id="veiculoDescricao"></p>
                            <p><strong>Preço:</strong> <span id="veiculoPreco"></span></p>
                            <p><strong>Ano:</strong> <span id="veiculoAno"></span></p>
                            <p><strong>Quilometragem:</strong> <span id="veiculoQuilometragem"></span></p>
                            <p><strong>Cor:</strong> <span id="veiculoCor"></span></p>
                            <p><strong>Potência:</strong> <span id="veiculoPotencia"></span></p>
                            <p><strong>Motor:</strong> <span id="veiculoMotor"></span></p>
                            <p><strong>Câmbio:</strong> <span id="veiculoCambio"></span></p>
                            <p><strong>Direção:</strong> <span id="veiculoDirecao"></span></p>
                            <p><strong>Tração:</strong> <span id="veiculoTracao"></span></p>
                            <p><strong>Avaliação:</strong> <span id="veiculoAvaliacao"></span> estrelas</p>
                            <p><strong>Categoria:</strong> <span id="veiculoCategoria"></span></p>
                            <p><strong>Montadora:</strong> <span id="veiculoMontadora"></span></p>
                            <p><strong>Disponível:</strong> <span id="veiculoDisponivel"></span></p>
                            <p><strong>Destaque:</strong> <span id="veiculoDestaque"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
